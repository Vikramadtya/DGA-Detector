# Introduction

Adversaries have stopped using hard-coded domain lists and IP addresses, which are useless once blocked DGAs by comparison is easy to implement, diﬃcult to block, and maybe impossible to predict in advance and can be quickly modiﬁed if the previously used algorithm becomes known.

A Domain Generating Algorithm (DGA) is a program or subroutine that provides malware with new domains on-demand or on the ﬂy. Each bot of a given botnet is shipped with the same DGA.

Advantages of DGA botnet is that if the domain of C&C server is detected and blocked all connections to these addresses, the botnet has not been eliminated completely. Botmaster just registers a new address in domain dataset and the bot will still operate as normal. This strategy improves the robustness of botnet even though one or more CC servers are located and taken down, the bots will ﬁnally get the relocated CC server via DNS queries to the next set of automatically generated domains. There are some well-known DGA botnets such as Conﬁcker, Kraken, etc, each of them has its own domain generation algorithm for a list of candidate CC domain.

## Communication with C&C

To contact the botmaster, each bot periodically executes a domain generation algorithm (DGA) that, given a random seed (e.g., the current date), produces a list of candidate CC domains. The bot then attempts to resolve these domain names by sending DNS queries until one of the domains resolves to the IP address of a C&C server.

The key concept is that, at any moment, only a small number of domains is active and resolves to the true IPs of the C&C server. This characteristic makes dealing with DGAs very expensive for the security defenders because they would need to track—and register Only the DGA authors (or the botmasters) know exactly when the upcoming rendezvous domain has to be registered and activated. Only the DGA authors (or the botmasters) know exactly when the upcoming rendezvous domain has to be registered and activated.

## Other Detection Approaches

1. DGAs can be determined from captured malware code, we can generate the domains ahead of time and still identify and block botnet C&C traﬃc. The existing solutions are largely based on reverse engineering of the bot malware executable, which is not always feasible.
2. A blacklist of known command and control (C&C) domains to detect bots and block their traﬃc, such a botnet detection approach is static because the blacklist is updated only after running an external (and often manual) process of domain discovery.
3. Traﬃc analysis, DNS traﬃc logs analysis, statistical analysis, and so on
4. Look for clusters of similar domains being queried by multiple clients. This only catches infections in their later stages, when they have spread to several clients.
5. Some deep learning approaches have been identiﬁed using LSTM and adversarial neural net for detection of the malicious domains.

## DGA & its types

Even when a certain DGA is known (for example, by reverse engineering a malware sample), it’s still diﬃcult—or even impossible—to eﬀectively block it.

First, there is the sheer number of possible domains that can be generated. Gameover Zeus, for example, generates 1,000 domains every day. This amounts to 365,000 domains that need to be generated in advance and blocked, which would strain on ﬁrewalls and other network-ﬁltering solutions.


A DGA typically has three components:
1. A time-sensitive “seed”
2. A domain “body” generator that uses this seed
3. A set of top-level domains (TLDs)

The DGA can be basically categorised in two broad types.
(a) Word-based : The diﬃculty of detecting this simple algorithm is that the domains do not seem to be randomly generated and the commonly used words may appear in many legitimate domain names.
(b) Randomly generated : Our approach targets these type of AGD.


## The Approach

Tested the classifying models with the dataset containing more than 30,000 domain, including domain generated by the DGA botnets like Conﬁcker, Tinba, Bebloh, Tovar, Goz, Kraken and 100.000 domains with a high ranking from Alexa. The proposed method can detect up to 92-98 per cent of Algorithmically generated domain and distinguish 80 per cent of DGA correctly.


# Considerations for detection of AGD

## Requirements

1. DGA domains and Benign domain
2. Proper ﬁltering out of illegal data
3. Pre-processing of the data
4. Feature set to represent a domain
5. Distance Measure and other parameter to be used in the models.
6. Clustering algorithm
7. Classiﬁer algorithm

## Open Question

1. How to deal with dictionary based DGA.
2. Overlapping features for diﬀerent DGA.
3. Feature to distinguish among diﬀerent AGD.
4. Use of host addresses while clustering.
5. Subset of feature’s to be used in classiﬁers.
6. Testing in live environment
7. Misspelling checker needs to be tested.
8. Use of small cluster to form a ﬁnal cluster.

# Architecture

The machine learning framework consists of the following four main components:

1. The pattern ﬁlter is used to ﬁlter the NxDomains queries in order to obtain the domains from them and check if they were due to a human typo.
2. A feature extractor extracts feature from the incoming domains that are not in the blacklist. Those domains will be processed in the next component.
3. A two-level machine learning model, the ﬁrst-level clustering and the second-level classiﬁcation. We apply the clustering method to group domains sequenced by the DGA and then try classifying these groups to known DGA those that do not ﬁt any known DGA model are (automatically) assigned a New-DGA- vX label, where X is a unique identiﬁer.
4. A prediction model to identify DGA domains, we ﬁrst use various classiﬁcation models to classify DGA domains and normal domains.

## Passive Module

The DNS is a crucial component as whenever a host tries to communicate with C&C server by sending queries, it is responsible for the translation of domain name to its corresponding IP address.

The architecture for detection of DGA based botnet consists of two modules, the goals of our method are to analyse NXDomain which is generated by DGA botnet, so all benign domains have to be removed from the collection.

1. Filtering & Feature Extraction module
2. Bot Detection module

The brief description of these modules, their components and usage for C&C bot detection is discussed.

1. Each of the compromised assets will generate several DNS queries resulting in NXDomains, and a subset of these NXDomains will likely be queried by more than one compromised machine.
2. We ﬁrst automatically identify and ﬁlter out “accidental”, user-generated NXDomains due to typos or misconﬁgurations.
3. Then we ﬁnd cluster’s of NXDomains, each cluster corresponds to a type of DGA botnet.
4. The clustering algorithm clusters domains based on the similarity in the make-ups of domain names and can be extended as well to use the groups of machines that queried these domains.
5. Followed by using statistical learning techniques to build a model of the DGA, these clusters are used to detect future compromised machines running the same DGA.
6. Instances of AGD names drawn from the same DGA can be generalized into “ﬁngerprint” of the generation algorithm itself, without reversing its implementation.
7. If a cluster cannot be assigned to a known model, then a new model is produced, indicating a new DGA variant or family.

Botnet access behaviour of the domain name has a strong regularity, which does not follow the change of DGA algorithm. By using a DGA algorithm, malware can use diﬀerent domains to connect back to the C&C server. In this way, a large number of failure domain names will be generated, whose active time is more concentrated. They can be collected in the access behaviour of the client and DNS traﬃc ﬂow..

## Active Module

1. On the ﬁrst phase, the NXDomains will be ﬁltered using blacklist & white list.
2. To identify compromised hosts, we collect the domains generated by a host, hi, and we ask the AGD Classiﬁer whether it likely “belongs” to a DGA or not.
3. If the answer is yes, we ask the DGA Classiﬁer whether it likely “belongs” to a previously seen DGA or not.
4. If there is a high probable match and this repeats certain number of times for a host then the host is considered to be compromised and will be labeled with the name of the (suspected) DGA bot that it is running.
5. Otherwise, the domain resolution is allowed based on the assumption the passive mode will detect them again if it is from DGA due to high number of NXDomain generated by a DGA which will form a cluster due to similar semantic features.

# Feature Template

Diﬀerences between the white list and the blacklist were analyzed to build a feature template from the angle of lexicology and linguistics.

DGA domain name is commonly composed of letter, number and symbol by random combinations, which is diﬀerent from the character probability distribution of legal domain names We designed the following feature template for RF:

1. Length of domain
2. Vowel Count to Domain Length Ratio
3. Digit Count to Domain Length Ratio
4. Repeat Character Count To Domain Len Ratio
5. Entropy of domain
6. N-gram score in white list
7. N-gram score in dictionary
8. Meaningful Characters To Domain Len Ratio
9. Length Of Longest Meaningful Substring To Domain Length
10. Consecutive Characters To Domain Length Ratio

