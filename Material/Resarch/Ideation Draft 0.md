# IDEATION DRAFT 

## INTRODUCTION TO DGA

An infected machine periodically uses a **seed and a domain generation algorithm (DGA)** to automatically generate *a large batch of domain names*, and does a Domain Name Service (DNS) query to discover the domains’ IP addresses.

##### COMMUNICATION WITH BOT

Each bot **periodically executes a domain generation algorithm (DGA) that, given a random seed (e.g., the current date), produces a list of candidate C&C domains**. The bot then attempts to resolve these domain names by sending DNS queries until one of the domains resolves to the IP address of a C&C server. This strategy provides a remarkable level of agility because even if one or more C&C domain names or IP addresses are identified and taken down, the *bots will eventually get the IP address of the relocated C&C server via DNS queries* to the next set of automatically generated domains.

> If a machine can be detected querying malware DGA domains, it may be possible to disinfect or quarantine it before the infection produces any symptoms.



## OTHER APPROACHES BEING USED

1. DGAs can be determined from captured malware code, we can generate the domains ahead of time and still identify and block botnet C&C traffic. The existing solutions are largely based on reverse engineering of the bot malware executables, which is not always feasible.
2. A blacklist of known command and control (C&C) domains to detect bots and block their traffic, such a botnet detection approach is static because the blacklist is updated only after running an external (and often manual) process of domain discovery. 
3. Look for **clusters of similar domains being queried by multiple clients**. This only ==catches infections in their later stages, when they have spread to several clients==. ==Combine this with other approaches, so that if a DGA is not detected early it may be detected later on.==



## SCENARIOS FOR

### INFECTION

| STAGE   | KEY POINT                                                   | NO. OF HOST INFECTED                          |
| ------- | ----------------------------------------------------------- | --------------------------------------------- |
| INITIAL | Each host must be individually checked.                     | Less                                          |
| SEVERE  | Pattern in overall network traffic visible after clustering | Multitude of bots trying to connect with C&C. |

### DGA

| DISCOVERED | BLACKLISTED | KEY POINT                        |
| ---------- | ----------- | -------------------------------- |
| YES        | YES         | Won't generate NxDomain traffic. |
| YES        | NO          | Lot of NxDomain                  |
| NO         | NO          | Lot of NxDomain                  |

## CONSIDERATION FOR SUCCESS

- What features to see in the domains
  - similar length
  - similar level of “randomness”
  - similar character frequency distribution
- Classifier to use 
  - Deep Learning approach or 
  - Standard (SVM, Naive Bayes .. etc)
- Distance formula to use for clustering 
- Clustering Method (K-Mean,X-Mean, Hiearichal, ...) 
- Cleaning the data (Pre-Processing)
- What else can we learn from benign domain.
- Keep blacklist database up-to date



## SUMMARY OF DESIGN

The purpose of building a DGA classifier is not to take down botnets, but to discover and detect the use on our network or services.

#### DEPLOYEMENT LOCATION

Placed “below” the local recursive DNS (RDNS) server or at the edge of a network to monitor DNS query/response messages from/to the machines within the network.

### ACTIVE DISCOVERY 

1. Create a blacklist of malicious domains from the data availible.
2. Train a classifier for discovering benign domain names. (Use the benign domains availible at sites like Alexa .etc. )
3. Use the DGA classifier to see if the domain can be AGD (Algorithimically generated domain) from a modelled DGA.
4. If nothing is found raise a flag, and pass the query to resolver.
5. If domain doesn't exists check if the domain is mis-spelling of popular domain by calculating distance from benign domains.
6. Report if its not a mis-spelling to observe the host traffic for pattern.

> The fact that the DGA is pseudo random, DNS traffic lookup patterns will emerge as all infected hosts will request the same set of domain names in a given epoch of time.

![IMG_EDF981304A35-1](/Users/vikramadityasingh/Downloads/IMG_EDF981304A35-1.jpeg)

### PASSIVE DISCOVERY

Searches for relatively large clusters of NXDomains that 

1. Have similar syntactic features, 
2. Are queried by multiple potentially compromised machines during a given epoch. 

Main objective of this NXDomain clustering process is to group together domain names that likely are automatically generated by the same algorithm running on multiple machines within the monitored network

1. The clustering algorithm clusters domains based on the similarity in the make-ups of domain names as well as the groups of machines that queried these domains.
2. Use a DGA Classifier to prune NXDomain clusters that appear to be generated by DGAs that we have previously discovered and modeled, or that contain domain names that are similar to popular legitimate domains. 
3. The final output of the DGA Discovery module is a set of NXDomain clusters, each of which likely represents the NXDomains generated by previously unknown or not yet modeled DGA-bots.
4. If a cluster cannot be assigned to a known model, then a new model is produced, indicating a new DGA variant or family.
5. Every time a new DGA is discovered, build model of what the domains generated by this new DGA “look like”.
6. A Hidden Markov Model (HMM) that focuses on finding single active domain names queried by $h_i$ (Infected host) that are likely generated by a DGA.

![IMG_0029A18086B0-1](/Users/vikramadityasingh/Downloads/IMG_0029A18086B0-1.jpeg)


## EXAMPLE

### ACTIVE DISCOVERY
###### MALICIOUS DOMAIN

![IMG_2FF1E4AE72EF-1](/Users/vikramadityasingh/Downloads/IMG_2FF1E4AE72EF-1.jpeg)

###### BENIGN DOMAIN

![IMG_BB0C2708C827-1](/Users/vikramadityasingh/Downloads/IMG_BB0C2708C827-1.jpeg)

### REQUIREMENTS

![IMG_32BF89C2E3F9-1](/Users/vikramadityasingh/Downloads/IMG_32BF89C2E3F9-1.jpeg)


## BENEFITS

1. Sinkholed domains (Malicious domains registered by authorities to avoid exploitation) are also identified during ACTIVE discovery.
2. Not found domain traffic is filtered for typos so noise in the data set we are feeding our CLUSTERER reduces.
3. New DGA are found faster due to flags raised for strange behaviour.

## REFERENCE 

1. A Taxonomy of Domain-Generation Algorithms 
2. CLEAN:  an Approach for Detecting Benign Domain Names based on Passive DNS Traffic.
3. Detecting the DGA-Based Malicious Domain Names.
4. Finding Domain-Generation Algorithms by Looking at Length Distributions.
5. From Throw-Away Traffic to Bots: Detecting the Rise of DGA-Based Malware.
6. Detecting Algorithmically Generated Domains Using Data Visualization and N-Grams Methods
7. Detecting Algorithmically Generated Malicious Domain Names
8. Kindred Domains: Detecting and Clustering Botnet Domains Using DNS Traffic 