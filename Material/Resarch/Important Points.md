# Important

[toc]

### DGA

DGA is used to generate a large number of domain names for the C&C server. **periodically generate a large number of pseudo-random non-existent domain names for the Command-and-Control (C&C) server. The malware then attempts to resolve these generated domain names by sending DNS queries until one of the domains resolves to the IP address of a C&C server.**

**Domain names generated by the DGA is also known as Algorithmically Generated Domains (AGD). DGA is employed to prevent the C&C server from being taken down and hinder blacklisting attempts.**

##### Exploit

The adversary registers one of those DGA created domain names for the C&C Server in advance using the same algorithm embedded in the malware. Eventually, malware queries the adversary’s pre-registered domain name and resolves the IP address of the C&C server. Then the malware starts communicating with the C&C server and receives new commands and updates. If the malware cannot find the C&C server at its previous domain name, it queries to the next set of DGA generated domain names until it finds one that works. Adversary registers the domain name 1 hour prior to an attack and disposes the domain name within 24 hours.

![Screenshot 2020-05-13 at 7.36.24 AM](/Users/vikramadityasingh/Library/Mobile Documents/com~apple~CloudDocs/Resarch/Images/DGA_Attack.png)

#### Internals

The general methodology of any DGA is using a deterministic pseudo-random generator (PRNG) to generate a list of candidate domain names. The seed of a PRNG can be the current date, some magic numbers, an exchange rate, etc. This **random generator can be a single uniform distribution generator**, e.g. use a combination of bitshift, xor, divide, multiply, and modulo operations to generate a string sequence as the domain name (such as in Conficker, Ramnit, and others); it **can also be a rule generator**, which selects from some knowledge base (such as in Suppobox). 

> The key to the PRNG-based DGA methodology is a deterministic random generator, where the DGA sequence is predictable from both the malware and the attacker, so the attacker can generate and select some of these domains for C&C service, and the malware just needs to loop over and reach the chosen C&C.

#### Seed

==The seed is accessible to both the adversary and the malware.==

1. Static seed
2. Dynamic seed

Domain Generation Algorithm (DGA) takes seed value as input parameter to generate pseudo-random strings and algorithmically appends TLD (top-level domain) (.com, .org, .ca, .ru) with the string to output possible domain names.

The static seed could be a dictionary of word, concatenation of random strings and numbers or anything that adversary can modify at will. Dynamic seeds are time dependent, the seed changes with time. Daily trending twitter hashtag, insignificant digits of foreign exchange rate, weather temperature can be also leveraged as dynamic seed value. Often current date and time is used as seed value in DGA to generate domain names.



> trick to throw off countermeasures is to not use all the domains that the algorithm produces, but only certain ones. This will drastically increase the number of domains necessary to register by researchers if they plan to intercept the traffic.

==When it comes to TLDs, *.xyz*, *.top*, and *.bid* are very popular at the moment. This is due to the reasons mentioned earlier: low costs and quick availability, because the registrars allow automated and anonymous domain registrations.==

### Domain Fluxing

Constant changing of the domain name for the C&C server through the implementation of DGA is known as **Domain-Fluxing**. 



### Requirements 

- The routines have to generate domains that are predictable to both sides of the communication chain.
- The routines have to be as unpredictable for security researchers as possible.
- The domain registration fee has to be low, given the huge amounts of domains that will be used.
- The need for speed can be enormous.
- The registration process has to be anonymous or at least untraceable.

### Techniques

#### Reactionary Detection

Reactionary detection relies on non-supervised clustering techniques and contextual information like network NXDOMAIN responses,WHOIS information, and passive DNS to make an assessment of domain name legitimacy. 

Recent attempts at detecting DGA domain names with deep learning techniques have been extremely successful, with F1 scores  of over 99%. These deep learning methods typically utilize LSTM  and CNN architectures,though deep word embeddings  have shown great promise for detecting dictionary DGA. However, these deep learning approaches can be vulnerable to adversarial techniques.



## DNS

filter the NXDomains by the RCODE recorded in the passive DNS traffic

---------

###### Sources

[DOMAIN GENERATION ALGORITHM – DGA IN MALWARE](https://hackersterminal.com/domain-generation-algorithm-dga-in-malware/)

[Explained: Domain Generating Algorithm](https://blog.malwarebytes.com/security-world/2016/12/explained-domain-generating-algorithm/)

[Domain generation algorithm](https://en.wikipedia.org/wiki/Domain_generation_algorithm#cite_note-5)

